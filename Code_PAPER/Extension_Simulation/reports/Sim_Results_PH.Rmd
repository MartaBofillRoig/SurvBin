---
title: "Preliminary results Simulation Study"
author: "Marta Bofill Roig and Guadalupe Gomez Melis"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes
    toc_depth: 3
    number_sections: true
    code_folding: hide 
    theme: paper   
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(survival)
library(survminer)
library(copula) 
library(pracma) # for using the function 'integral' 
require(zoo) # 'rollmean' function
require(muhaz)
```

Summary:

- Short results simulation study

# Simulations under the null hypothesis H0

## Scenarios considered


| Parameter | Values |
| ----------- | ----------- |
| $a$ | $0.5,1,2$ |
| $b$ | $1$ |
| $\tau$ | $1$ |
| $\tau_b$ | $0.5,1$ |
| $r$ | $3$ |
| $p_0$ | $0.1,0.3$ |
| $d$ | $0$ |
| $HR$ | $1$ |
| $\theta$ | $0.001,2,3$ |
| $n$ | $500$ |
| $\eta$ | $1$ |
| $\rho,\gamma$ | $0,1$ |
| $\omega_b$ | $0.5$ |


```{r}
load("C:/Users/Marta/Nextcloud/Gitkraken/SurvBin/Code_PAPER/Extension_Simulation/results/RESULTS_PAPER_H0.RData")
data_H0 = data
```

## Results


```{r}
d= summary(data_H0[,17:20])
knitr::kable(
  d, caption = 'Empirical alpha'
)
```


```{r}
d= summary(data_H0[,21:22])
knitr::kable(
  d, caption = 'Empirical alpha (univariate tests)'
)
```



```{r, fig.width=10}
signlevel_data <- data.frame(signlevel=c(data_H0$Test_Alpha_pluginU,
                                         data_H0$Test_Alpha_pluginP,
                                         data_H0$Test_Alpha_Boots,
                                         data_H0$Test_Alpha_Bonf
                                         # ,
                                         # data_H0$Test_Alpha_B,
                                         # data_H0$Test_Alpha_S
                                         ),
                             Test=c(rep("Unpooled",length(data_H0$Test_Alpha_pluginU)),
                                    rep("Pooled",length(data_H0$Test_Alpha_pluginP)),
                                    rep("Bootstrap",length(data_H0$Test_Alpha_Boots)),
                                    rep("Bonferroni",length(data_H0$Test_Alpha_Bonf))
                                    # ,
                                    # rep("BE",length(data_H0$Test_Alpha_B)),
                                    # rep("SE",length(data_H0$Test_Alpha_S))
                                    )
                             )

ggplot(signlevel_data, aes(x=Test, y=signlevel)) + geom_boxplot()
```


## TO DO LIST

  - Check plugin empirical alpha
  - Check follow-up configuration
  - Compare results bootstrap with more boots samples


# Simulations under the alternative hypothesis H1

## Scenarios H0 FALSE -- case 1 


| Parameter | Values |
| ----------- | ----------- |
| $a$ | $0.5,1,2$ |
| $b$ | $1$ |
| $\tau$ | $1$ |
| $\tau_b$ | $0.5,1$ |
| $r$ | $3$ |
| $p_0$ | $0.1,0.3$ |
| $d$ | $0.1$ |
| $HR$ | $0.8$ |
| $\theta$ | $0.001,2,3$ |
| $n$ | $500$ |
| $\eta$ | $1$ |
| $\rho,\gamma$ | $0,1$ |
| $\omega_b$ | $0.25,0.5,0.75$ |


```{r}
load("C:/Users/Marta/Nextcloud/Gitkraken/SurvBin/Code_PAPER/Extension_Simulation/results/RESULTS_PAPER_H1_case1.RData")
data_H1 = data
```


## Results

```{r}
d= summary(data_H1[,17:20])
knitr::kable(
  d, caption = 'Empirical powers'
)
```

```{r}
d= summary(data_H1[,21:22])
knitr::kable(
  d, caption = 'Empirical powers (univariate tests)'
)
```

```{r, fig.width=10}
power_data <- data.frame(power=c(data_H1$Test_Power_pluginU,
                                 data_H1$Test_Power_pluginP,
                                 data_H1$Test_Power_Boots,
                                 data_H1$Test_Power_Bonf
                                 # ,
                                 # data_H1$Test_Power_B,
                                 # data_H1$Test_Power_S
                                 ),
                             Test=c(rep("Unpooled",length(data_H1$Test_Power_pluginU)),
                                    rep("Pooled",length(data_H1$Test_Power_pluginP)),
                                    rep("Bootstrap",length(data_H1$Test_Power_Boots)),
                                    rep("Bonferroni",length(data_H1$Test_Power_Bonf))
                                    # ,
                                    # rep("BE",length(data_H1$Test_Power_B)),
                                    # rep("SE",length(data_H1$Test_Power_S))
                                    ),
                             omegab=c(data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab
                                    )
                             )

ggplot(power_data, aes(x=Test, y=power, color=as.factor(omegab))) + geom_boxplot()
```

## Scenarios H0 FALSE -- case 2


| Parameter | Values |
| ----------- | ----------- |
| $a$ | $0.5,1,2$ |
| $b$ | $1$ |
| $\tau$ | $1$ |
| $\tau_b$ | $0.5,1$ |
| $r$ | $3$ |
| $p_0$ | $0.1,0.3$ |
| $d$ | $0$ |
| $HR$ | $0.8$ |
| $\theta$ | $0.001,2,3$ |
| $n$ | $500$ |
| $\eta$ | $1$ |
| $\rho,\gamma$ | $0,1$ |
| $\omega_b$ | $0.25,0.5,0.75$ |


```{r}
load("C:/Users/Marta/Nextcloud/Gitkraken/SurvBin/Code_PAPER/Extension_Simulation/results/RESULTS_PAPER_H1_case2.RData")
data_H1 = data
```


## Results

```{r}
d= summary(data_H1[,17:20])
knitr::kable(
  d, caption = 'Empirical powers'
)
```

```{r}
d= summary(data_H1[,21:22])
knitr::kable(
  d, caption = 'Empirical powers (univariate tests)'
)
```

```{r, fig.width=10}
power_data <- data.frame(power=c(data_H1$Test_Power_pluginU,
                                 data_H1$Test_Power_pluginP,
                                 data_H1$Test_Power_Boots,
                                 data_H1$Test_Power_Bonf
                                 # ,
                                 # data_H1$Test_Power_B,
                                 # data_H1$Test_Power_S
                                 ),
                             Test=c(rep("Unpooled",length(data_H1$Test_Power_pluginU)),
                                    rep("Pooled",length(data_H1$Test_Power_pluginP)),
                                    rep("Bootstrap",length(data_H1$Test_Power_Boots)),
                                    rep("Bonferroni",length(data_H1$Test_Power_Bonf))
                                    # ,
                                    # rep("BE",length(data_H1$Test_Power_B)),
                                    # rep("SE",length(data_H1$Test_Power_S))
                                    ),
                             omegab=c(data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab
                                    )
                             )

ggplot(power_data, aes(x=Test, y=power, color=as.factor(omegab))) + geom_boxplot()
```


## Scenarios H0 FALSE -- case 2


| Parameter | Values |
| ----------- | ----------- |
| $a$ | $0.5,1,2$ |
| $b$ | $1$ |
| $\tau$ | $1$ |
| $\tau_b$ | $0.5,1$ |
| $r$ | $3$ |
| $p_0$ | $0.1,0.3$ |
| $d$ | $0.1$ |
| $HR$ | $1$ |
| $\theta$ | $0.001,2,3$ |
| $n$ | $500$ |
| $\eta$ | $1$ |
| $\rho,\gamma$ | $0,1$ |
| $\omega_b$ | $0.25,0.5,0.75$ |


```{r}
load("C:/Users/Marta/Nextcloud/Gitkraken/SurvBin/Code_PAPER/Extension_Simulation/results/RESULTS_PAPER_H1_case3.RData")
data_H1 = data
```


## Results

```{r}
d= summary(data_H1[,17:20])
knitr::kable(
  d, caption = 'Empirical powers'
)
```

```{r}
d= summary(data_H1[,21:22])
knitr::kable(
  d, caption = 'Empirical powers (univariate tests)'
)
```

```{r, fig.width=10}
power_data <- data.frame(power=c(data_H1$Test_Power_pluginU,
                                 data_H1$Test_Power_pluginP,
                                 data_H1$Test_Power_Boots,
                                 data_H1$Test_Power_Bonf
                                 # ,
                                 # data_H1$Test_Power_B,
                                 # data_H1$Test_Power_S
                                 ),
                             Test=c(rep("Unpooled",length(data_H1$Test_Power_pluginU)),
                                    rep("Pooled",length(data_H1$Test_Power_pluginP)),
                                    rep("Bootstrap",length(data_H1$Test_Power_Boots)),
                                    rep("Bonferroni",length(data_H1$Test_Power_Bonf))
                                    # ,
                                    # rep("BE",length(data_H1$Test_Power_B)),
                                    # rep("SE",length(data_H1$Test_Power_S))
                                    ),
                             omegab=c(data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab,
                                     data_H1$omegab
                                    )
                             )

ggplot(power_data, aes(x=Test, y=power, color=as.factor(omegab))) + geom_boxplot()
```





## TO DO LIST

Scenarios to consider:
  
  - Balanced/unbalanced sample sizes
  - Equal/unequal weights
  - PH/nonPH survival alternatives
  - Three situations: $H_{0,b}\cap H_{0,s}$, $H_{1,b}\cap H_{0,s}$, and $H_{0,b}\cap H_{1,s}$. 


